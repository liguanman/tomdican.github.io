<!DOCTYPE HTML><html><head><meta charset="utf-8"><title>Mongodb guide | less is more</title><meta name="author" content="tomdican"><meta name="description" content="Step 1 – Adding the MongoDB RepositoryThe mongodb-org package does not exist within the default repositories for CentOS. However, MongoDB maintains a "><meta name="keywords" content="技术,mongo,指南"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1"><meta property="og:title" content="Mongodb guide"><meta property="og:site_name" content="less is more,done what you want everyday"><meta property="og:image" content="undefined"><link rel="alternative" href="/atom.xml" title="less is more" type="application/atom+xml"><link href="/favicon.png" rel="icon"><link rel="stylesheet" href="/css/bootstrap.min.css" media="screen" type="text/css"><link rel="stylesheet" href="/css/font-awesome.css" media="screen" type="text/css"><link rel="stylesheet" href="/css/style.css" media="screen" type="text/css"><link rel="stylesheet" href="/css/highlight.css" media="screen" type="text/css"><link rel="stylesheet" href="/css/google-fonts.css" media="screen" type="text/css"><link rel="stylesheet" href="/css/responsive.css" media="screen" type="text/css"><link rel="stylesheet" href="/css/sidenav.css" media="screen" type="text/css"><link rel="stylesheet" href="/css/selection-sharer.css" media="screen" type="text/css"><!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]--><script src="/js/jquery-2.0.3.min.js"></script><script>!function(){var t=document.createElement("script"),e=window.location.protocol.split(":")[0];t.src="https"===e?"https://zz.bdstatic.com/linksubmit/push.js":"http://push.zhanzhang.baidu.com/push.js";var s=document.getElementsByTagName("script")[0];s.parentNode.insertBefore(t,s)}()</script><script type="application/ld+json">
  {
    "@context" : "http://schema.org",
    "@type" : "WebSite",
    "name" : "less is more",
    "url" : "http://www.tomdican.xyz"
  }
</script><script type="application/ld+json">
  { "@context" : "http://schema.org",
    "@type" : "Organization",
    "name" : "tomdican blog",
    "url" : "http://www.tomdican.xyz",
    "logo": "http://www.tomdican.xyz/logo.png",
    "sameAs" : [ "" ]
  }
</script></head><body id="body" data-spy="scroll" data-target=".toc"><div class="container" id="container"><div class="content"><div class="page-header"><h1> <a class="brand" href="/">less is more</a><span class="split"></span> <span class="title">Mongodb guide</span></h1></div><div class="row page"><div class="col-xs-12 col-sm-3 col-md-3 toc"><script type="text/javascript">jQuery(document).ready(function(){generateWikiTOC(".note",".toc",2,2)})</script></div><div class="col-xs-12 col-sm-9 col-md-9 note"><h2 id="Step-1-–-Adding-the-MongoDB-Repository"><a href="#Step-1-–-Adding-the-MongoDB-Repository" class="headerlink" title="Step 1 – Adding the MongoDB Repository"></a>Step 1 – Adding the MongoDB Repository</h2><p>The mongodb-org package does not exist within the default repositories for CentOS. However, MongoDB maintains a dedicated repository. Let’s add it to our server.<br>With the vi editor, create a .repo file for yum, the package management utility for CentOS:</p><pre><code>sudo vi /etc/yum.repos.d/mongodb-org.repo
</code></pre><p>Then, visit the Install on Red Hat section of MongoDB’s documentation and add the repository information for the latest stable release to the file:</p><pre><code>/etc/yum.repos.d/mongodb-org.repo
[mongodb-org-3.2]
name=MongoDB Repository
baseurl=https://repo.mongodb.org/yum/redhat/$releasever/mongodb-org/3.2/x86_64/
gpgcheck=1
enabled=1
gpgkey=https://www.mongodb.org/static/pgp/server-3.2.asc
</code></pre><p>Save and close the file.<br>Before we move on, we should verify that the MongoDB repository exists within the yum utility. The repolist command displays a list of enabled repositories:</p><pre><code>yum repolist
</code></pre><p>Output</p><pre><code>repo id                          repo name
base/7/x86_64                    CentOS-7 - Base
extras/7/x86_64                  CentOS-7 - Extras
mongodb-org-3.2/7/x86_64         MongoDB Repository
updates/7/x86_64                 CentOS-7 - Updates
</code></pre><p>With the MongoDB Repository in place, let’s proceed with the installation.</p><h2 id="Step-2-–-Installing-MongoDB"><a href="#Step-2-–-Installing-MongoDB" class="headerlink" title="Step 2 – Installing MongoDB"></a>Step 2 – Installing MongoDB</h2><p>We can install the mongodb-org package from the third-party repository using the yum utility.</p><pre><code>sudo yum install mongodb-org
</code></pre><p>There are two Is this ok [y/N]: prompts. The first one permits the installation of the MongoDB packages and the second one imports a GPG key. The publisher of MongoDB signs their software and yum uses a key to confirm the integrity of the downloaded packages. At each prompt, type Y and then press the ENTER key.</p><p>Next, start the MongoDB service<br>service mongod start</p><p>configuration</p><pre><code>vi /etc/mongo.conf
</code></pre><p>add below:</p><pre><code>security:
    authorization: enabled
</code></pre><p> create and login admin database<br> $ mongo</p><pre><code>&gt; use admin
&gt; db.createUser(
     {
       user:&quot;admin&quot;,
       pwd:&quot;secret&quot;,
       roles:[{role:&quot;root&quot;,db:&quot;admin&quot;}]
     }
  )
&gt; exit

mongo -u admin -p secret -authenticationDatabase admin
</code></pre><h2 id="manage-user"><a href="#manage-user" class="headerlink" title="manage user"></a>manage user</h2><p>MongoDB is a nosql database server. The default installation provides you the access of database using mongo command through command line without authentication. In this tutorial you will learn how to create users in Mongodb server with proper authentications.</p><h3 id="Create-Admin-User"><a href="#Create-Admin-User" class="headerlink" title="Create Admin User"></a>Create Admin User</h3><p>You can use below commands to create user with admin privileges in your MongoDB server.</p><figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">$ mongo</div><div class="line"></div><div class="line">&gt; use admin</div><div class="line"></div><div class="line">&gt; db.createUser(</div><div class="line">     &#123;</div><div class="line">       user:"myadmin",</div><div class="line">       pwd:"secret",</div><div class="line">       roles:[&#123;role:"root",db:"admin"&#125;]</div><div class="line">     &#125;</div><div class="line">  )</div><div class="line"></div><div class="line">&gt; exit</div></pre></td></tr></table></figure><p>Now try to connect with above credentials through command line.<br></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ mongo -u myadmin -p  --authenticationDatabase admin</div></pre></td></tr></table></figure><p></p><h3 id="Add-User-for-Database"><a href="#Add-User-for-Database" class="headerlink" title="Add User for Database"></a>Add User for Database</h3><p>You can also create database specific users, that user will have access to that database only. You can also specify access level for that user on database. For example we are creating a user account with read write access on mydb database.</p><figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">&gt; use mydb</div><div class="line"></div><div class="line">&gt; db.createUser(</div><div class="line">    &#123;</div><div class="line">      user: "mydbuser",</div><div class="line">      pwd: "mydbsecret",</div><div class="line">      roles: ["readWrite"]</div><div class="line">    &#125;</div><div class="line"> ) </div><div class="line"></div><div class="line">&gt; exit</div></pre></td></tr></table></figure><p>To verify authentication use following command. In result 1 means authentication succeeded.</p><figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">&gt; db.auth('mydbuser','mydbsecret')</div></pre></td></tr></table></figure><p>To list all users for a database, use following command.</p><figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">&gt; db.getUsers()</div></pre></td></tr></table></figure><p>Drop User for DatabaseYou may also remove user from database using following command.</p><figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">&gt; use mydb</div><div class="line"></div><div class="line">&gt; db.dropUser('mydbuser')</div></pre></td></tr></table></figure><h2 id="use-db"><a href="#use-db" class="headerlink" title="use db"></a>use db</h2><p>1) 查看数据库</p><ul><li>查看所有数据库与mySQL查看数据库命令一样，MongoDB也是使用show dbs命令查看当前实例中所有的数据库。</li></ul><figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">&gt; show dbs;</div><div class="line">local         0.328GB</div><div class="line">test          (empty)</div></pre></td></tr></table></figure><ul><li>查看当前使用数据库要查看当前正在使用的数据库，使用db命令。示例如下：</li></ul><figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">&gt; db</div><div class="line">test</div></pre></td></tr></table></figure><p>如上所示，进入Mongo shell后，如果未选择（切换）任何数据库，默认工作在test数据库。</p><p>2) 新建与切换数据库MongoDB新建与切换数据库使用同一个命令use。当数据库存在时，会将工作数据库切换到对应数据库，数据库不存在时，会新建数据库。语法结构如下：</p><p>use DATABASE_NAME</p><ul><li>新建数据库使用use命令新建数据库：</li></ul><figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">&gt; use newDB</div><div class="line">switched to db newDB</div><div class="line">&gt; db</div><div class="line">newDB</div></pre></td></tr></table></figure><ul><li>新建的数据库，使用show dbs命令查看不到，要想使用可显示，需要至少插入一个文档：</li></ul><figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">&gt; show dbs;</div><div class="line">local         0.328GB</div><div class="line">test          (empty)</div><div class="line">&gt; db.sites.insert(&#123;name:'itbilu.com'&#125;)</div><div class="line">WriteResult(&#123; "nInserted" : 1 &#125;)</div><div class="line">&gt; show dbs</div><div class="line">local         0.328GB</div><div class="line">newDB         0.078GB</div><div class="line">test          (empty)</div></pre></td></tr></table></figure><ul><li>切换工作数据库use命令同样可用于切换工作数据库，示例如下：</li></ul><figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">&gt; use test</div><div class="line">switched to db test</div><div class="line">&gt; db</div><div class="line">test</div></pre></td></tr></table></figure><p>3) 删除数据库db表示对当前使用数据库的引用。删除数据库首先使用use命令切换到要删除的数据库，然后使用db.dropDatabase()命令删除数据库。示例如下：</p><figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">&gt; use newDB</div><div class="line">switched to db newDB</div><div class="line">&gt; db.dropDatabase()</div><div class="line">&#123; "dropped" : "newDB", "ok" : 1 &#125;</div><div class="line">&gt; show dbs</div><div class="line">local         0.328GB</div><div class="line">test          (empty)</div></pre></td></tr></table></figure><p>4) 查询数据</p><p>find的第一个参数是查询条件，其形式也是一个文档，决定了要返回哪些文档，空的査询文档{}会匹配集合的全部内容。要是不指定査询文档，默认就是{}，如同SQL中”SELECT * FROM TABLENAME”语句。</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">// 显示</div><div class="line"><span class="keyword">show</span> collections</div><div class="line">//将返回集合中所有文档</div><div class="line">db.collection.find()</div><div class="line">//或者</div><div class="line">db.collection.find(&#123;&#125;)</div><div class="line">//重命名</div><div class="line">db.rrecord.renameCollection(<span class="string">"record"</span>)</div></pre></td></tr></table></figure><p>第一个参数若为键/值对时，查询过程中就意味着执行了条件筛选，就如同我们使用Linq查询数据库一样。下面查询操作将返回user集合中age键值为16的文档集合。</p><figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">//mongo db</div><div class="line">db.user.find(&#123;age:16&#125;)</div><div class="line">//Linq to sql</div><div class="line">dbContext.user.select(p=&gt;p.age==16)</div></pre></td></tr></table></figure><p>　　上面的查询默认执行“==”操作(就如同linq中 p.age==16)，文档中若存在相同键的值和查询文档中键的值相等的话，就会返回该文档。</p><h2 id="import-mongo-collection"><a href="#import-mongo-collection" class="headerlink" title="import mongo collection :"></a>import mongo collection :</h2><pre><code>mongoimport --db test --collection bookCategory --file bookCategory.json
mongoexport --host localhost --port 27017 -u test -p tset --collection bookC ategory   --out bookCategory.json
</code></pre><div><center> <span class="update" id="update"><a href="/">home</a> - <a href="#">top</a> - <a rel="external nofollow" href="https://coding.net/u/tomdican/p/blog/git/blame/source/_posts/Mongodb-guide.md" target="_blank">history</a> - <a rel="external nofollow" href="https://twitter.com/search?f=tweets&amp;q=%23lessismoreMongodbguide" target="_blank">twitter</a> - <a rel="external nofollow" href="http://s.weibo.com/weibo/%2523lessismoreMongodbguide%2523" target="_blank">weibo</a> - 2017.01.20 02&nbsp; updated</span></center></div></div></div></div></div><div class="container-narrow"><footer><p> <a style="color:#999" rel="external nofollow" href="https://github.com/tomdican/hexo-theme-less">Less</a> theme.</p><script type="text/javascript">var _gaq=_gaq||[];_gaq.push(["_setAccount","true"]),_gaq.push(["_trackPageview"]),function(){var t=document.createElement("script");t.type="text/javascript",t.async=!0,t.src=("https:"==document.location.protocol?"https://":"http://")+"stats.g.doubleclick.net/dc.js";var e=document.getElementsByTagName("script")[0];e.parentNode.insertBefore(t,e)}(),function(t,e,a,c,n,s,o){t.GoogleAnalyticsObject=n,t[n]=t[n]||function(){(t[n].q=t[n].q||[]).push(arguments)},t[n].l=1*new Date,s=e.createElement(a),o=e.getElementsByTagName(a)[0],s.async=1,s.src="https://www.google-analytics.com/analytics.js",o.parentNode.insertBefore(s,o)}(window,document,"script",0,"ga"),ga("create","UA-97368934-1","auto"),ga("send","pageview")</script></footer></div><div id="sidebar-toggle" class="sidebar-toggle"><div class="sidebar-toggle-line-wrap"><span class="sidebar-toggle-line sidebar-toggle-line-first" style="width:100%;top:0;transform:rotateZ(0);opacity:1;left:0"></span><span class="sidebar-toggle-line sidebar-toggle-line-middle" style="opacity:1;width:100%;left:0;top:0;transform:rotateZ(0)"></span><span class="sidebar-toggle-line sidebar-toggle-line-last" style="width:100%;top:0;transform:rotateZ(0);opacity:1;left:0"></span></div></div><script src="/js/bootstrap.min.js"></script><script src="/js/jquery.tableofcontents.min.js"></script><script src="/js/tocgenerator.min.js"></script><script src="/js/main.js"></script><script src="/js/selection-sharer.js"></script><script type="text/javascript">var hashtags="less is moreMongodb guide".replace(/ /g,""),options={weibo:"2258300554",twitter:"zhuodim",hashtags:hashtags};$(".note").selectionSharer(options)</script></body></html>